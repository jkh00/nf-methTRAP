#!/usr/bin/env nextflow
params.publish_dir_mode = 'copy'
params.samplesheet = true
params.outdir = ''
    
// Optional steps
params.model = null
params.aligner = false
params.pileup_method = false
params.bedgraph = false
params.pb_all = false
params.no_trim = false



/*
 * Print very cool text and parameter info to log. 

 */

log.info """\
==============================================================================================================================================
==============================================================================================================================================

 ,---.   .--. ________               ,---.    ,---.    .-''-. ,---------. .---.  .---.,---------. .-------.       ____    .-------.  
|    \\  |  ||        |              |    \\  /    |  .'_ _   \\\\          \\|   |  |_ _|\\          \\|  _ _   \\    .'  __ `. \\  _(`)_ \\ 
|  ,  \\ |  ||   .----'              |  ,  \\/  ,  | / ( ` )   '`--.  ,---'|   |  ( ' ) `--.  ,---'| ( ' )  |   /   '  \\  \\| (_ o._)| 
|  |\\_ \\|  ||  _|____   _ _    _ _  |  |\\_   /|  |. (_ o _)  |   |   \\   |   '-(_{;}_)   |   \\   |(_ o _) /   |___|  /  ||  (_,_) / 
|  _( )_\\  ||_( )_   | ( ' )--( ' ) |  _( )_/ |  ||  (_,_)___|   :_ _:   |      (_,_)    :_ _:   | (_,_).' __    _.-`   ||   '-.-'  
| (_ o _)  |(_ o._)__|(_{;}_)(_{;}_)| (_ o _) |  |'  \\   .---.   (_I_)   | _ _--.   |    (_I_)   |  |\\ \\  |  |.'   _    ||   |      
|  (_,_)\\  ||(_,_)     (_,_)--(_,_) |  (_,_)  |  | \\  `-'    /  (_(=)_)  |( ' ) |   |   (_(=)_)  |  | \\ `'   /|  _( )_  ||   |      
|  |    |  ||   |                   |  |      |  |  \\       /    (_I_)   (_{;}_)|   |    (_I_)   |  |  \\    / \\ (_ o _) //   )      
'--'    '--''---'                   '--'      '--'   `'-..-'     '---'   '(_,_) '---'    '---'   ''-'   `'-'   '.(_,_).' `---'     

----------------------------------------------------------------------------------------------------------------------------------------------
Jin Yan Khoo                                       
----------------------------------------------------------------------------------------------------------------------------------------------

  Parameters:
     samplesheet     : ${params.samplesheet}
     outdir            : ${params.outdir}

==============================================================================================================================================
==============================================================================================================================================
"""
    .stripIndent(false)

/*
 ===========================================
 * Import subworkflows 
 ===========================================
 */

include { PACBIO } from './subworkflows/pacbio/main'
include { ONT } from './subworkflows/ont/main'

/*
 ===========================================
 * Workflows
 ===========================================
 */


workflow {
  if(params.samplesheet) {
  Channel.fromPath(params.samplesheet)
                       .splitCsv(header:true)
                       .branch { it -> 
                          pacbio: it.method == "pacbio"
                          ont: it.method == "ont" }
                       .set { ch_input }

      ch_input.ont.view { "ONT reads are $it" }
      ch_input.pacbio.view { "Pacbio reads are $it" }


       PACBIO(ch_input.pacbio)
       ONT(ch_input.ont)
       
  }
} 

